<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Instagram – Not Following Back | Local-First Tools</title>

    <!-- Viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- SEO -->
    <meta name="description" content="Find who you follow on Instagram that doesn’t follow you back. 100% local, no uploads.">
    <meta name="keywords" content="instagram, followers, following, local first">
    <meta name="author" content="localfirsttools">

    <!-- Open Graph -->
    <meta property="og:title" content="Instagram – Not Following Back">
    <meta property="og:description" content="Analyze your Instagram following and followers locally.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/assets/images/favicon.png">
    <meta property="og:url" content="https://localfirsttools.pages.dev">

    <!-- Favicon -->
    <link rel="icon" href="/assets/images/favicon.webp" type="image/webp">

    <!-- Styles -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <style>
        .file-group {
            margin: 16px 0;
        }
        .results {
            margin-top: 24px;
        }
        .results ul {
            columns: 2;
        }
        .results li {
            break-inside: avoid;
        }
        .count {
            font-weight: bold;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <div id="header"></div>

    <!-- Main layout -->
    <div class="layout">
        <aside id="sidebar"></aside>

        <main class="content">
            <div class="content-inner">
                <section class="page-content">

                    <h1>Instagram – Not Following Back</h1>

                    <p>
                        Select your <strong>following.json</strong> and one or more
                        <strong>followers_*.json</strong> files from your Instagram data export.
                    </p>

                    <p>
                        <strong>Everything runs locally.</strong> No uploads, no tracking.
                    </p>

                    <div class="file-group">
                        <label><strong>following.json</strong></label><br>
                        <input type="file" id="followingFile" accept=".json">
                    </div>

                    <div class="file-group">
                        <label><strong>followers_*.json</strong> (one or more)</label><br>
                        <input type="file" id="followersFiles" accept=".json" multiple>
                    </div>

                    <button id="analyzeBtn">Analyze</button>

                    <div id="results" class="results"></div>

                </section>
            </div>
        </main>

        <aside class="right-ads"></aside>
    </div>

    <!-- Footer -->
    <div id="footer"></div>

    <!-- Scripts -->
    <script src="/assets/js/includes.js"></script>
    <script src="/assets/js/ui.js"></script>

    <!-- Logic -->
    <script>
        async function readJSON(file) {
            return JSON.parse(await file.text());
        }

        document.getElementById("analyzeBtn").addEventListener("click", async () => {
            const followingFile = document.getElementById("followingFile").files[0];
            const followersFiles = document.getElementById("followersFiles").files;
            const resultsEl = document.getElementById("results");

            resultsEl.innerHTML = "";

            if (!followingFile || followersFiles.length === 0) {
                resultsEl.innerHTML = "<p>Please select following.json and at least one followers file.</p>";
                return;
            }

            try {
                /* -------- FOLLOWING -------- */
                const followingJSON = await readJSON(followingFile);

                const followingSet = new Set(
                    followingJSON.relationships_following
                        .map(u => u.title)
                        .filter(Boolean)
                );

                /* -------- FOLLOWERS -------- */
                const followersSet = new Set();

                for (const file of followersFiles) {
                    const json = await readJSON(file);

                    json.forEach(u => {
                        const username = u.string_list_data?.[0]?.value;
                        if (username) followersSet.add(username);
                    });
                }

                /* -------- COMPARE -------- */
                const notFollowingBack = [...followingSet]
                    .filter(u => !followersSet.has(u))
                    .sort((a, b) => a.localeCompare(b));

                /* -------- RENDER -------- */
                resultsEl.innerHTML = `
                    <div class="count">
                        ${notFollowingBack.length} people don’t follow you back
                    </div>
                    <ul>
                        ${notFollowingBack.map(u => `<li>${u}</li>`).join("")}
                    </ul>
                `;

            } catch (err) {
                console.error(err);
                resultsEl.innerHTML = "<p>Error processing files. Make sure they are valid Instagram JSON files.</p>";
            }
        });
    </script>

</body>
</html>
